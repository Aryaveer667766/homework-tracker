<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Swadishth Business Manager</title>
<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:#f8f8f8;color:#222}
header{background:#d34d2d;color:#fff;padding:1rem 2rem;display:flex;justify-content:space-between;align-items:center}
header h1{margin:0;font-size:1.2rem}
button{background:#d34d2d;color:white;border:none;padding:0.6rem 1rem;border-radius:6px;cursor:pointer}
button:hover{background:#b03e24}
.container{padding:1rem 2rem}
#login-page,#dashboard{display:none}
.login-box{max-width:350px;margin:10vh auto;background:white;padding:2rem;border-radius:10px;box-shadow:0 2px 10px rgba(0,0,0,0.1)}
input,select,textarea{width:100%;padding:0.6rem;margin:0.4rem 0;border:1px solid #ccc;border-radius:6px}
.order-form,.goal-form,.chat-box{background:white;padding:1rem;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1);margin-bottom:1rem}
table{width:100%;border-collapse:collapse;margin-top:1rem}
th,td{border-bottom:1px solid #ddd;padding:0.5rem;text-align:left;font-size:0.9rem}
th{background:#f2f2f2}
.chat-messages{height:200px;overflow-y:auto;border:1px solid #ccc;padding:0.5rem;background:#fafafa;margin-bottom:0.5rem;border-radius:6px}
.message{padding:0.3rem 0;border-bottom:1px solid #eee}
.goal-item{padding:0.4rem;border-bottom:1px solid #eee}
#notification{position:fixed;top:20px;right:20px;background:#222;color:#fff;padding:1rem 1.5rem;border-radius:8px;opacity:0;pointer-events:none;transition:all 0.4s ease;z-index:999}
#notification.show{opacity:1;pointer-events:auto}
</style>
</head>
<body>

<div id="notification"></div>

<div id="login-page">
  <div class="login-box">
    <h2>Swadishth Login</h2>
    <input type="text" id="username" placeholder="Username" />
    <input type="password" id="password" placeholder="Password" />
    <button id="loginBtn">Login</button>
    <p id="loginMsg" style="color:red;margin-top:10px;"></p>
  </div>
</div>

<div id="dashboard">
  <header>
    <h1>Swadishth Business Manager</h1>
    <button id="logoutBtn">Logout</button>
  </header>

  <div class="container">
    <!-- Order Form -->
    <div class="order-form">
      <h3>Add New Order</h3>
      <input id="customerName" placeholder="Customer Name" />
      <input id="customerPhone" placeholder="Phone Number" />
      <textarea id="items" placeholder="Items Ordered"></textarea>
      <input id="amount" type="number" placeholder="Total Amount (‚Çπ)" />
      <select id="paymentStatus">
        <option value="Pending">Pending</option>
        <option value="Paid">Paid</option>
      </select>
      <select id="deliveryStatus">
        <option value="Not Delivered">Not Delivered</option>
        <option value="Delivered">Delivered</option>
      </select>
      <textarea id="notes" placeholder="Additional Notes"></textarea>
      <button id="addOrderBtn">Add Order</button>
    </div>

    <table id="ordersTable">
      <thead>
        <tr>
          <th>#</th><th>Customer</th><th>Phone</th><th>Items</th>
          <th>Amount</th><th>Payment</th><th>Delivery</th><th>Notes</th><th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <!-- Goals Section -->
    <div class="goal-form">
      <h3>Team Goals</h3>
      <input id="goalInput" placeholder="Enter new goal" />
      <button id="addGoalBtn">Add Goal</button>
      <div id="goalsList"></div>
    </div>

    <!-- Chat Section -->
    <div class="chat-box">
      <h3>Team Chat üí¨</h3>
      <div class="chat-messages" id="chatMessages"></div>
      <input id="chatMessage" placeholder="Type your message..." />
      <button id="sendMessageBtn">Send</button>
    </div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBRwSrbSvrFAW5dTyQN0BoRHS3_6iLrV_E",
  authDomain: "homeworkbrothers-12345.firebaseapp.com",
  projectId: "homeworkbrothers-12345",
  storageBucket: "homeworkbrothers-12345.firebasestorage.app",
  messagingSenderId: "77683184454",
  appId: "1:77683184454:web:9b0bc1e8e5028943a3cb47",
  measurementId: "G-21XLQGRZJ0",
  databaseURL: "https://homeworkbrothers-12345-default-rtdb.asia-southeast1.firebasedatabase.app/"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

const loginPage = document.getElementById('login-page');
const dashboard = document.getElementById('dashboard');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const loginMsg = document.getElementById('loginMsg');
const notification = document.getElementById('notification');
let currentUser = null;

const users = {
  sahil: "sahil@swadishth",
  aryaveer: "arya@swadishth",
  aryan: "aryan@swadishth"
};

// --- Notification helper ---
function showNotification(msg) {
  notification.textContent = msg;
  notification.classList.add('show');
  setTimeout(()=>notification.classList.remove('show'),5000);
}

function showDashboard() {
  loginPage.style.display = 'none';
  dashboard.style.display = 'block';
  loadOrders();
  loadGoals();
}

loginBtn.onclick = () => {
  const u = username.value.trim();
  const p = password.value.trim();
  if ((u==="sahil" && p==="sahil@swadishth")||(u==="aryaveer"&&p==="arya@swadishth")||(u==="aryan"&&p==="aryan@swadishth")) {
    currentUser = u;
    localStorage.setItem("user", u);
    showDashboard();
  } else loginMsg.innerText = "Invalid credentials!";
};

logoutBtn.onclick = () => {
  localStorage.removeItem("user");
  location.reload();
};

if(localStorage.getItem("user")){
  currentUser = localStorage.getItem("user");
  showDashboard();
}

/* ------------------ Orders Section -------------------- */
let orders = JSON.parse(localStorage.getItem("orders") || "[]");
const ordersTableBody = document.querySelector("#ordersTable tbody");

function loadOrders(){
  ordersTableBody.innerHTML="";
  orders.forEach((o,i)=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${i+1}</td><td>${o.name}</td><td>${o.phone}</td>
      <td>${o.items}</td><td>‚Çπ${o.amount}</td>
      <td>${o.payment}</td><td>${o.delivery}</td><td>${o.notes}</td>
      <td><button onclick="editOrder(${i})">‚úè</button>
      <button onclick="deleteOrder(${i})">üóë</button></td>`;
    ordersTableBody.appendChild(tr);
  });
}
window.editOrder = (i)=>{
  const o=orders[i];
  customerName.value=o.name;
  customerPhone.value=o.phone;
  items.value=o.items;
  amount.value=o.amount;
  paymentStatus.value=o.payment;
  deliveryStatus.value=o.delivery;
  notes.value=o.notes;
  deleteOrder(i);
};
window.deleteOrder = (i)=>{
  orders.splice(i,1);
  localStorage.setItem("orders",JSON.stringify(orders));
  loadOrders();
};
addOrderBtn.onclick=()=>{
  const order={
    name:customerName.value,phone:customerPhone.value,
    items:items.value,amount:amount.value,payment:paymentStatus.value,
    delivery:deliveryStatus.value,notes:notes.value
  };
  if(order.name && order.amount){
    orders.push(order);
    localStorage.setItem("orders",JSON.stringify(orders));
    loadOrders();
    customerName.value=customerPhone.value=items.value=amount.value=notes.value="";
  }else alert("Please fill required fields");
};

/* ------------------ Goals Section -------------------- */
const goalInput=document.getElementById("goalInput");
const goalsList=document.getElementById("goalsList");
const addGoalBtn=document.getElementById("addGoalBtn");

function loadGoals(){
  onValue(ref(db,"goals/"),(snapshot)=>{
    const data=snapshot.val()||{};
    goalsList.innerHTML="";
    Object.keys(data).forEach((id)=>{
      const g=data[id];
      const div=document.createElement("div");
      div.className="goal-item";
      div.innerHTML=`${g.text} ${g.by?`<small>(${g.by})</small>`:""}`;
      goalsList.appendChild(div);
      if(g.by!==currentUser) showNotification(`üéØ New Goal: ${g.text} by ${g.by}`);
    });
  });
}
addGoalBtn.onclick=()=>{
  const text=goalInput.value.trim();
  if(text){
    push(ref(db,"goals/"),{text,by:currentUser});
    goalInput.value="";
  }
};

/* ------------------ Chat Section -------------------- */
const chatMessages=document.getElementById("chatMessages");
const chatMessage=document.getElementById("chatMessage");
const sendMessageBtn=document.getElementById("sendMessageBtn");

onValue(ref(db,"chat/"),(snapshot)=>{
  const data=snapshot.val()||{};
  chatMessages.innerHTML="";
  Object.keys(data).forEach(id=>{
    const msg=data[id];
    const div=document.createElement("div");
    div.className="message";
    div.innerHTML=`<b>${msg.user}:</b> ${msg.text}`;
    chatMessages.appendChild(div);
    if(msg.user!==currentUser) showNotification(`üí¨ ${msg.user}: ${msg.text}`);
  });
  chatMessages.scrollTop=chatMessages.scrollHeight;
});

sendMessageBtn.onclick=()=>{
  const text=chatMessage.value.trim();
  if(text){
    push(ref(db,"chat/"),{text,user:currentUser,time:Date.now()});
    chatMessage.value="";
  }
};
</script>
</body>
</html>
